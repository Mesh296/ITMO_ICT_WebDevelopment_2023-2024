<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://example.com/task5/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Task 5 - My Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tasks <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../task1/" class="dropdown-item">Task 1</a>
</li>
                                    
<li>
    <a href="../task2/" class="dropdown-item">Task 2</a>
</li>
                                    
<li>
    <a href="../task3/" class="dropdown-item">Task 3</a>
</li>
                                    
<li>
    <a href="../task4/" class="dropdown-item">Task 4</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Task 5</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../task4/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" class="nav-link disabled">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#no5" class="nav-link">Задание №5</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#_1" class="nav-link">Решение</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#_2" class="nav-link">Демонстрация работы</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="no5">Задание №5</h2>
<p>Необходимо написать простой web-сервер для обработки GET и POST http
запросов средствами Python и библиотеки socket.</p>
<h2 id="_1">Решение</h2>
<ol>
<li>http-server</li>
</ol>
<pre><code class="language-python">import socket

class MyHTTPServer:
    #The constructor of the MyHTTPServer class. It creates a socket object and sets options for it, then binds the socket to the given address and port, and listens on that port. Additionally, it initializes a dictionary (self.grades) to store the scores.
    def __init__(self, host, port):
        self.conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.conn.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        self.conn.bind((host, port))
        self.conn.listen(1)
        self.grades = {}

    #This function is the main loop of the server. It listens for and accepts connections from clients and calls the serve_client function to serve the client's request.
    def serve_forever(self):
        while True:
            client, address = self.conn.accept()
            self.serve_client(client)

    #This function reads data sent from the client, then calls the parse_request function to parse the HTTP request.
    def serve_client(self, client):
        data = client.recv(1024).decode(&quot;utf-8&quot;)
        self.parse_request(client, data)

    #This function parses the HTTP request to extract the method, URL, and HTTP version. It also tries to extract parameters from the URL if any.
    def parse_request(self, client, data):
        lines = data.split(&quot;\n&quot;)
        method, url, version = lines[0].split()
        params = (
            {p.split(&quot;=&quot;)[0]: p.split(&quot;=&quot;)[1] for p in url.split(&quot;?&quot;)[1].split(&quot;&amp;&quot;)}
            if &quot;?&quot; in url
            else None
        )
        self.handle_request(client, method, params)

    #This function processes the HTTP request based on the method (GET or POST) and extracted parameters. If the method is GET, it sends the score list as HTML. If the method is POST, it stores the grade into the self.grades dictionary and sends a confirmation message.
    def handle_request(self, client, method, params):
        if method == &quot;GET&quot;:
            self.send_response(client, 200, &quot;OK&quot;, self.grades_to_html())
        elif method == &quot;POST&quot;:
            discipline = params.get(&quot;discipline&quot;)
            grade = params.get(&quot;grade&quot;)
            self.grades[discipline] = grade
            self.send_response(client, 200, &quot;OK&quot;, &quot;Grade successfully saved!&quot;)
        else:
            self.send_response(client, 404, &quot;Not Found&quot;, &quot;Incorrect method, try a different method.&quot;)

    #This function sends an HTTP response to the client with a status code, reason, and specific content. The response is sent as an HTTP string.
    def send_response(self, client, code, reason, body):
        response = f&quot;HTTP/1.1 {code} {reason}\nContent-Type: text/html\n\n{body}&quot;
        client.send(response.encode(&quot;utf-8&quot;))
        client.close()

    #This function creates an HTML page containing a list of grades from the self.grades dictionary.
    def grades_to_html(self):
        page = (
            f&quot;&lt;html&gt;&lt;body&gt;&lt;ul&gt;&quot;
            f&quot;{''.join([f'&lt;li&gt;{discipline}: {grade}' for discipline, grade in self.grades.items()])}&quot;
            f&quot;&lt;/ul&gt;&lt;/body&gt;&lt;/html&gt;&quot;
        )
        return page


def main():
    host = &quot;127.0.0.1&quot;
    port = 2002
    server = MyHTTPServer(host, port)
    try:
        server.serve_forever()
    except KeyboardInterrupt:
        server.conn.close()

if __name__ == &quot;__main__&quot;:
    main()
</code></pre>
<h2 id="_2">Демонстрация работы</h2>
<p><img alt="POST 1" src="../assets/task5_POST_1.jpg" />
<img alt="POST 2" src="../assets/task5_POST_2.jpg" />
<img alt="GET" src="../assets/task5_GET.jpg" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
